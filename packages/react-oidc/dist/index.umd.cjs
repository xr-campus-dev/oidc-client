(function(f,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("react/jsx-runtime"),require("@axa-fr/oidc-client"),require("react")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","@axa-fr/oidc-client","react"],s):(f=typeof globalThis<"u"?globalThis:f||self,s(f["react-oidc"]={},f.jsxRuntime,f.oidcClient,f.React))})(this,function(f,s,n,l){"use strict";const F="default",B=(t,c,e=!1)=>async(...o)=>await c().fetchWithTokens(t,e)(...o),z=(t=null,c=F,e=!1)=>o=>r=>{const{fetch:a}=I(t||r.fetch,c,e);return s.jsx(o,{...r,fetch:a})},I=(t=null,c=F,e=!1)=>{const o=t||window.fetch,r=n.OidcClient.get;return{fetch:l.useCallback((d,i)=>B(o,()=>r(c),e)(d,i),[o,c])}},U=()=>s.jsx("div",{className:"oidc-authenticating",children:s.jsxs("div",{className:"oidc-authenticating__container",children:[s.jsx("h1",{className:"oidc-authenticating__title",children:"Error authentication"}),s.jsx("p",{className:"oidc-authenticating__content",children:"An error occurred during authentication."})]})}),K=()=>s.jsx("div",{className:"oidc-authenticating",children:s.jsxs("div",{className:"oidc-authenticating__container",children:[s.jsx("h1",{className:"oidc-authenticating__title",children:"Authentication in progress"}),s.jsx("p",{className:"oidc-authenticating__content",children:"You will be redirected to the login page."})]})}),$=()=>Math.random().toString(36).substr(2,6),G=(t,c)=>(e,o)=>{if(typeof t.CustomEvent=="function")return new t.CustomEvent(e,o);const r=o||{bubbles:!1,cancelable:!1,detail:void 0},a=c.createEvent("CustomEvent");return a.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),a.prototype=t.Event.prototype,a},H=(t,c,e)=>({replaceState:(o,r)=>{const a=e(),d=r||t.history.state;t.history.replaceState({key:a,state:d},null,o),t.dispatchEvent(c("popstate"))}}),Q=()=>H(window,G(window,document),$),M=()=>s.jsx("div",{className:"oidc-callback",children:s.jsxs("div",{className:"oidc-callback__container",children:[s.jsx("h1",{className:"oidc-callback__title",children:"Authentication complete"}),s.jsx("p",{className:"oidc-callback__content",children:"You will be redirected to your application."})]})}),J=({callBackError:t,callBackSuccess:c,configurationName:e,withCustomHistory:o})=>{const[r,a]=l.useState(!1);l.useEffect(()=>{let u=!0;return(async()=>{const _=n.OidcClient.get;try{const{callbackPath:O}=await _(e).loginCallbackAsync();(o?o():Q()).replaceState(O||"/")}catch(O){u&&(console.warn(O),a(!0))}})(),()=>{u=!1}},[]);const d=t||U,i=c||M;return r?s.jsx(d,{configurationName:e}):s.jsx(i,{configurationName:e})},V=()=>s.jsx("span",{className:"oidc-loading",children:"Loading"}),X=()=>s.jsx("div",{className:"oidc-serviceworker",children:s.jsxs("div",{className:"oidc-serviceworker__container",children:[s.jsx("h1",{className:"oidc-serviceworker__title",children:"Unable to authenticate on this browser"}),s.jsx("p",{className:"oidc-serviceworker__content",children:"Your browser is not secure enough to make authentication work. Try updating your browser or use a newer browser."})]})}),Z=()=>s.jsx("div",{className:"oidc-session-lost",children:s.jsxs("div",{className:"oidc-session-lost__container",children:[s.jsx("h1",{className:"oidc-session-lost__title",children:"Session timed out"}),s.jsx("p",{className:"oidc-session-lost__content",children:"Your session has expired. Please re-authenticate."})]})}),x=({configurationName:t})=>(l.useEffect(()=>{(async()=>{const e=n.OidcClient.get;e(t).silentLoginCallbackAsync()})()},[]),s.jsx(s.Fragment,{})),R=({configurationName:t})=>{const c=n.getParseQueryStringFromLocation(window.location.href),e=n.OidcClient.get,o=e(t);let r=null;for(const[a,d]of Object.entries(c))a==="state"||a==="scope"||(r===null&&(r={}),r[a]=d);return l.useEffect(()=>{o.tokens||o.loginAsync(null,r,!0,c.scope)},[]),s.jsx(s.Fragment,{})},ee=({callbackErrorComponent:t,callbackSuccessComponent:c,redirect_uri:e,silent_redirect_uri:o,silent_login_uri:r,children:a,configurationName:d,withCustomHistory:i=null,location:u})=>{const k=window?n.getPath(window.location.href):"",[_,O]=l.useState(k);l.useEffect(()=>{const v=()=>O(n.getPath(window.location.href));return v(),window.addEventListener("popstate",v,!1),()=>window.removeEventListener("popstate",v,!1)},[]);const g=n.getPath(e);if(o&&_===n.getPath(o))return s.jsx(x,{configurationName:d});if(r&&_===n.getPath(r))return s.jsx(R,{configurationName:d});switch(_){case g:return s.jsx(J,{callBackError:t,callBackSuccess:c,configurationName:d,withCustomHistory:i});default:return s.jsx(s.Fragment,{children:a})}},te=l.memo(ee),q={name:"",data:null},se=({loadingComponent:t,children:c,configurationName:e})=>{const[o,r]=l.useState(!0),a=n.OidcClient.get,d=a(e);l.useEffect(()=>{let u=!0;return d&&d.tryKeepExistingSessionAsync().then(()=>{u&&r(!1)}),()=>{u=!1}},[e]);const i=t;return s.jsx(s.Fragment,{children:o?s.jsx(i,{configurationName:e}):s.jsx(s.Fragment,{children:c})})},T=({isLoading:t,loadingComponent:c,children:e,configurationName:o})=>{const r=c;return t?s.jsx(r,{configurationName:o,children:e}):s.jsx(s.Fragment,{children:e})},ne=({children:t,configuration:c,configurationName:e="default",callbackSuccessComponent:o=M,authenticatingComponent:r=K,loadingComponent:a=V,serviceWorkerNotSupportedComponent:d=X,authenticatingErrorComponent:i=U,sessionLostComponent:u=Z,onSessionLost:k=null,onLogoutFromAnotherTab:_=null,onLogoutFromSameTab:O=null,withCustomHistory:g=null,onEvent:v=null,getFetch:y=null,location:P=null})=>{const w=(L="default")=>n.OidcClient.getOrCreate(y??n.getFetchDefault,P??new n.OidcLocation)(c,L),[fe,ke]=l.useState(!0),[he,S]=l.useState(q),[Oe,_e]=l.useState("default");l.useEffect(()=>{const m=w(e).subscribeEvents((h,p)=>{v&&v(e,h,p)});return()=>{w(e).removeEventSubscription(m)}},[e,v]),l.useEffect(()=>{const m=w(e).subscribeEvents((h,p)=>{if(h===n.OidcClient.eventNames.refreshTokensAsync_error||h===n.OidcClient.eventNames.syncTokensAsync_error){if(k!=null){k();return}S({name:h,data:p})}else if(h===n.OidcClient.eventNames.logout_from_another_tab){if(_!=null){_();return}S({name:h,data:p})}else h===n.OidcClient.eventNames.logout_from_same_tab?O!=null&&O():h===n.OidcClient.eventNames.loginAsync_begin||h===n.OidcClient.eventNames.loginCallbackAsync_end||h===n.OidcClient.eventNames.loginAsync_error||h===n.OidcClient.eventNames.loginCallbackAsync_error?S({name:h,data:p}):h===n.OidcClient.eventNames.service_worker_not_supported_by_browser&&c.service_worker_only===!0&&S({name:h,data:p})});return _e(e),ke(!1),()=>{w(e).removeEventSubscription(m),S(q)}},[c,e]);const ve=u,ge=r,b=a,ye=d,be=i,A=fe||Oe!==e,N=w(e);switch(he.name){case n.OidcClient.eventNames.service_worker_not_supported_by_browser:return s.jsx(T,{loadingComponent:b,isLoading:A,configurationName:e,children:s.jsx(ye,{configurationName:e})});case n.OidcClient.eventNames.loginAsync_begin:return s.jsx(T,{loadingComponent:b,isLoading:A,configurationName:e,children:s.jsx(ge,{configurationName:e})});case n.OidcClient.eventNames.loginAsync_error:case n.OidcClient.eventNames.loginCallbackAsync_error:return s.jsx(T,{loadingComponent:b,isLoading:A,configurationName:e,children:s.jsx(be,{configurationName:e})});case n.OidcClient.eventNames.refreshTokensAsync_error:case n.OidcClient.eventNames.syncTokensAsync_error:case n.OidcClient.eventNames.logout_from_another_tab:return s.jsx(T,{loadingComponent:b,isLoading:A,configurationName:e,children:s.jsx(ve,{configurationName:e})});default:return s.jsx(T,{loadingComponent:b,isLoading:A,configurationName:e,children:s.jsx(te,{redirect_uri:N.configuration.redirect_uri,silent_redirect_uri:N.configuration.silent_redirect_uri,silent_login_uri:N.configuration.silent_login_uri,callbackSuccessComponent:o,callbackErrorComponent:i,authenticatingComponent:r,configurationName:e,withCustomHistory:g,location:P??new n.OidcLocation,children:s.jsx(se,{loadingComponent:b,configurationName:e,children:t})})})}},D=({children:t,callbackPath:c=null,extras:e=null,configurationName:o="default"})=>{const r=n.OidcClient.get,a=r(o);return l.useEffect(()=>{a.tokens||a.loginAsync(c,e)},[o,c,e]),a.tokens?s.jsx(s.Fragment,{children:t}):null},oe=(t,c=null,e=null,o="default")=>r=>s.jsx(D,{callbackPath:c,extras:e,configurationName:o,children:s.jsx(t,{...r})}),E="default",C=(t,c)=>{let e=!1;return t(c)&&(e=t(c).tokens!=null),e},ce=(t=E)=>{const c=n.OidcClient.get,[e,o]=l.useState(C(c,t));return l.useEffect(()=>{let i=!0;const u=c(t);o(C(c,t));const k=u.subscribeEvents((_,O)=>{(_===n.OidcClient.eventNames.logout_from_another_tab||_===n.OidcClient.eventNames.logout_from_same_tab||_===n.OidcClient.eventNames.token_aquired)&&i&&o(C(c,t))});return()=>{i=!1,u.removeEventSubscription(k)}},[t]),{login:(i=void 0,u=null,k=!1)=>c(t).loginAsync(i,u,!1,void 0,k),logout:(i=void 0,u=null)=>c(t).logoutAsync(i,u),renewTokens:async(i=null)=>{const u=await c(t).renewTokensAsync(i);return{accessToken:u.accessToken,accessTokenPayload:u.accessTokenPayload,idToken:u.idToken,idTokenPayload:u.idTokenPayload}},isAuthenticated:e}},W={accessToken:null,accessTokenPayload:null},re=t=>{const c=n.OidcClient.get,e=c(t);if(e.tokens){const o=e.tokens;return{accessToken:o.accessToken,accessTokenPayload:o.accessTokenPayload,generateDemonstrationOfProofOfPossessionAsync:e.configuration.demonstrating_proof_of_possession?(r,a)=>e.generateDemonstrationOfProofOfPossessionAsync(o.accessToken,r,a):null}}return W};function ae(t,c){return t.configuration.demonstrating_proof_of_possession?(e,o,r={})=>t.generateDemonstrationOfProofOfPossessionAsync(c.accessToken,e,o,r):null}const ie=(t=E)=>{const c=n.OidcClient.get,[e,o]=l.useState(re(t));return l.useEffect(()=>{let r=!0;const a=c(t);if(a.tokens){const i=a.tokens;o({accessToken:i.accessToken,accessTokenPayload:i.accessTokenPayload})}const d=a.subscribeEvents((i,u)=>{if((i===n.OidcClient.eventNames.token_renewed||i===n.OidcClient.eventNames.token_aquired||i===n.OidcClient.eventNames.logout_from_another_tab||i===n.OidcClient.eventNames.logout_from_same_tab||i===n.OidcClient.eventNames.refreshTokensAsync_error||i===n.OidcClient.eventNames.syncTokensAsync_error)&&r){const k=a.tokens;o(k!=null?{accessToken:k.accessToken,accessTokenPayload:k.accessTokenPayload,generateDemonstrationOfProofOfPossessionAsync:ae(a,k)}:W)}});return()=>{r=!1,a.removeEventSubscription(d)}},[t]),e},j={idToken:null,idTokenPayload:null},le=t=>{const c=n.OidcClient.get,e=c(t);if(e.tokens){const o=e.tokens;return{idToken:o.idToken,idTokenPayload:o.idTokenPayload}}return j},de=(t=E)=>{const c=n.OidcClient.get,[e,o]=l.useState(le(t));return l.useEffect(()=>{let r=!0;const a=c(t);if(a.tokens){const i=a.tokens;o({idToken:i.idToken,idTokenPayload:i.idTokenPayload})}const d=a.subscribeEvents((i,u)=>{if((i===n.OidcClient.eventNames.token_renewed||i===n.OidcClient.eventNames.token_aquired||i===n.OidcClient.eventNames.logout_from_another_tab||i===n.OidcClient.eventNames.logout_from_same_tab||i===n.OidcClient.eventNames.refreshTokensAsync_error||i===n.OidcClient.eventNames.syncTokensAsync_error)&&r){const k=a.tokens;o(k!=null?{idToken:k.idToken,idTokenPayload:k.idTokenPayload}:j)}});return()=>{r=!1,a.removeEventSubscription(d)}},[t]),e};var Y=(t=>(t.Unauthenticated="Unauthenticated",t.Loading="Loading user",t.Loaded="User loaded",t.LoadingError="Error loading user",t))(Y||{});const ue=(t="default",c=!1)=>{const o=n.OidcClient.get(t).userInfo(),[r,a]=l.useState({user:o,status:o?"User loaded":"Unauthenticated"}),[d,i]=l.useState(o?1:0),[u,k]=l.useState(o?1:0);l.useEffect(()=>{const O=n.OidcClient.get(t);let g=!0;if(O&&O.tokens){const y=d===u;if(y&&O.userInfo())return;a({...r,status:"Loading user"}),O.userInfoAsync(!y,c).then(P=>{g&&a({user:P,status:"User loaded"})}).catch(()=>a({...r,status:"Error loading user"})),k(d)}else a({user:null,status:"Unauthenticated"});const v=O.subscribeEvents(y=>{(y===n.OidcClient.eventNames.logout_from_another_tab||y===n.OidcClient.eventNames.logout_from_same_tab)&&g&&a({user:null,status:"Unauthenticated"})});return()=>{g=!1,O.removeEventSubscription(v)}},[d]);const _=()=>{i(d+1)};return{oidcUser:r.user,oidcUserLoadingState:r.status,reloadOidcUser:_}};Object.defineProperty(f,"OidcClient",{enumerable:!0,get:()=>n.OidcClient}),Object.defineProperty(f,"OidcLocation",{enumerable:!0,get:()=>n.OidcLocation}),Object.defineProperty(f,"TokenAutomaticRenewMode",{enumerable:!0,get:()=>n.TokenAutomaticRenewMode}),Object.defineProperty(f,"TokenRenewMode",{enumerable:!0,get:()=>n.TokenRenewMode}),f.OidcProvider=ne,f.OidcSecure=D,f.OidcUserStatus=Y,f.useOidc=ce,f.useOidcAccessToken=ie,f.useOidcFetch=I,f.useOidcIdToken=de,f.useOidcUser=ue,f.withOidcFetch=z,f.withOidcSecure=oe,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
